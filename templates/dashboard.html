<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/title.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/historychart.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/stock/modules/accessibility.js"></script>
</head>
<body>
    <div class="top-bar">
        <div class="left-area">
            <div class="menu-toggle" id="menuToggle">&#9776;</div>
            <div class="title">
                <a href="#">宜蘭五結奇利海岸</a>
            </div>
        </div>

        <div class="mobile-menu" id="mobileMenu">
            <div class="menu-links">
                <a href="{{ url_for('monitor') }}">監測系統</a>
                <a href="{{ url_for('oddset') }}">異常值設定</a>
                <a href="{{ url_for('history') }}">歷史資料</a>
            </div>
            <div class="logout-btn mobile-logout">
                <a href="{{ url_for('logout') }}">登出</a>
            </div>
        </div>

        <div class="right-area">
            <div class="menu-links">
                <a href="{{ url_for('monitor') }}">監測系統</a>
                <a href="{{ url_for('oddset') }}">異常值設定</a>
                <a href="{{ url_for('history') }}">歷史資料</a>
            </div>
        </div>
        <div class="user-area">
            <div class="logout-btn" title="登出">
                <a href="{{ url_for('logout') }}">登出</a>
            </div>
        </div>
    </div>

    <div class="pool-switcher">
        <button onclick="switchPool(this, '1')">水池 1</button>
        <button onclick="switchPool(this, '2')">水池 2</button>
        <button onclick="switchPool(this, '3')">水池 3</button>
        <button onclick="switchPool(this, '4')">水池 4</button>
    </div>

    <div class="main-content">
        <div class="video-box">
            <video id="video-box" controls>
                <source id="video-source" src="{{ url_for('static', filename='videos/pool1.mp4') }}" type="video/mp4">
                您的裝置暫時無法播放此影片。
            </video>
        </div>
        <div class="right-panel">
            <section class="water-quality" id="water-quality">
                <div class="datatitle">
                    <h2>水質數據</h2>
                    <button onclick="openChartModal()">查看歷史圖表</button>
                </div>
                <small>最後更新：<span id="last-update">0000-00-00 00:00</span></small>
                <div class="data-list">
                    <div class="data-item" id="temp-item">
                        <span>溫度</span>
                        <span id="temp">-- °C</span>
                    </div>
                    <div class="data-item" id="psu-item">
                        <span>鹽度</span>
                        <span id="psu">-- psu</span>
                    </div>
                    <div class="data-item" id="ph-item">
                        <span>酸鹼值</span>
                        <span id="ph">--</span>
                    </div>
                    <div class="data-item" id="do-item">
                        <span>溶氧</span>
                        <span id="do">-- mg/L</span>
                    </div>
                    <div class="data-item" id="orp-item">
                        <span>氧化還原電位</span>
                        <span id="orp">-- mV</span>
                    </div>
                </div>
            </section>
            <div class="control-buttons">
                <button id="control-feed" class="control-button normal" type="button" disabled>
                    <span class="control-button__label">投料</span>
                    <span class="control-button__state" id="control-feed-state">正常</span>
                </button>
                <button id="control-behavior" class="control-button normal" type="button" disabled>
                    <span class="control-button__label">行為</span>
                    <span class="control-button__state" id="control-behavior-state">正常</span>
                </button>
            </div>
        </div>
    </div>

    <div class="fab" onclick="toggleMenu()">
        <span class="fab__icon" aria-hidden="true">+</span>
    </div>
    <div class="fab-menu" id="fabMenu">
        <button onclick="openModal('interval')">設定平台升降間隔時間</button>
        <button onclick="openModal('feed')">設定飼料量</button>
    </div>

    <div id="settingModal" class="modal">
        <div class="modal-content setting-modal">
            <div class="setting-modal__header">
                <div>
                    <h4 id="modalTitle">設定項目</h4>
                </div>
                <button class="close-modal-btn" onclick="closeModal()">X</button>
            </div>
            <div class="setting-modal__pool">
                <label for="poolSelect">選擇水池</label>
                <select id="poolSelect">
                    <option value="1">水池 1</option>
                    <option value="2">水池 2</option>
                    <option value="3">水池 3</option>
                    <option value="4">水池 4</option>
                </select>
            </div>
            <div class="setting-modal__controls">
                <label for="modalInput">輸入數值</label>
                <div class="setting-modal__input-row">
                    <input type="number" id="modalInput" placeholder="請輸入數值" step="0.1">
                    <input type="range" id="modalRange">
                </div>
            </div>
            <div class="setting-modal__status">
                <span id="lastUpdateLabel">上次更新：--</span>
                <span id="lastValueLabel">上次數值：--</span>
            </div>
            <p id="modalError" class="setting-modal__error" style="display: none;">請輸入正確數值</p>
            <div class="setting-modal__actions">
                <button class="primary" onclick="applySetting()">確定</button>
                <button class="ghost" onclick="closeModal()">取消</button>
            </div>
        </div>
    </div>

    <div id="ChartModal" class="model">
        <div class="model-content">
            <div class="charttitle">
                <div id="metricButtonGroup" class="metric-buttons"></div>
                <button class="close-modal-btn" onclick="closeChartModal()">X</button>
            </div>
            <h3 id="primaryChartTitle" class="chart-heading">趨勢圖<span id="error-message" class="error-message"></span></h3>
            <div id="primary-chart-container" class="chart-container"></div>
        </div>
    </div>

    <script>
        const historyData = {{ history_data | default({}) | tojson | safe }};
        // console.log('historyData:', historyData);
    </script>
    <script src="{{ url_for('static', filename='js/title.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    <script src="{{ url_for('static', filename='js/historychart.js') }}"></script>
    <script src="{{ url_for('static', filename='js/controlset.js') }}"></script>
</body>
</html>
